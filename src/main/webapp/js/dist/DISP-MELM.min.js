/*! DISP-MELM 30-05-2014 */
app.controller("AddIconCtrl",["$scope","melmService",function(a,b){"use strict";a.go=function(a){b.go(a)},a.setAnchor=function(b){a.anchor=b},a.getClass=function(b){var c="anchor anchor-"+b;return a.anchor===b?c+" anchor-selected":c},a.anchor="SE",a.iconSelectedChoice="generate"}]),app.controller("AddLibraryCtrl",["$scope","melmService","$fileUploader",function(a,b,c){"use strict";var d=a.uploader=c.create({scope:a,url:melmContextRoot+"/rest/libraries/add"});d.bind("afteraddingfile",function(a,b){$("#libraryIconFile").attr("disabled","disabled").css("opacity",.4).css("filter","alpha(opacity=40)"),b.remove=function(){d.removeFromQueue(this),$("#libraryIconFile").removeAttr("disabled").css("opacity",0).css("filter","alpha(opacity=0)")}}),d.bind("beforeupload",function(b,c){c.alias="libraryIconFile",c.formData=[],c.formData.push({libraryName:"undefined"!=typeof a.libraryName?a.libraryName:"",version:"undefined"!=typeof a.version?a.version:""})}),d.bind("success",function(){b.go("/rest/libraries/")}),d.bind("error",function(a,b,c,d){BootstrapDialog.alert({title:"ERROR",message:d,type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}),d.filters.push(function(){return 1!==d.queue.length}),a.go=function(a){b.go(a)}}]),app.controller("AddLibraryIconCtrl",["$scope","$http","$window","melmService",function(a,b,c,d){"use strict";a.loadResources=function(){d.loadResources(a,"/rest/icons/linked/json")},a.back=function(){d.back()},a.selectImage=function(b,c){if(c.length>0)for(var d=0;d<c.length;d++)if(c[d].id===a.libraryId)return;a.id=b},a.isSelected=function(b){return a.id===b},a.getClasses=function(b,c){var d="col-xs-4 col-sm-2 col-md-1 icon-wrapper";if(c.length>0)for(var e=0;e<c.length;e++)if(c[e].id===a.libraryId)return d+" icon-wrapper-disabled icon-disabled";return a.id===b?d+" icon-selected":d},a.loadingVisible=!1,a.libraryId=c.libraryId,a.id=-1,a.itemsPerPage=48,a.currentPage=1,a.loadResources()}]),app.controller("CloneLibraryCtrl",["$scope","melmService",function(a,b){"use strict";a.back=function(){b.back()},a.iconChoice="existing"}]),app.directive("ngThumb",["$window",function(a){"use strict";var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]),app.filter("startFrom",function(){"use strict";return function(a,b){return void 0===a?a:a.slice(+b)}}).filter("checkmark",function(){"use strict";return function(a){return a?"✓":"✘"}}),app.service("melmService",["$http","$window",function(a,b){"use strict";this.encodeParams=function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},this.getRESTParameter=function(a,c){var d=b.location.href.split(a)[1];return d.split(c)[0]},this.loadResources=function(b,c,d,e){return b.loadingVisible=!0,a.get(melmContextRoot+c).success(function(a){b.resources=a,b.totalItems=a.length,b.loadingVisible=!1,d&&d()}).error(function(){e&&e()})},this.go=function(a){b.location=melmContextRoot+a},this.back=function(){b.history.back()},this.post=function(b){var c=this.encodeParams(b.params);return a.post(melmContextRoot+b.url,c,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,c,d,e){b.successCallback&&b.successCallback(a,c,d,e)}).error(function(a,c,d,e){b.errorCallback&&b.errorCallback(a,c,d,e)})},this.confirmDelete=function(a,b){BootstrapDialog.confirm("Do you really want to delete this resource ?",function(c){c&&a.deleteResource(b)})},this.confirmDeleteMultiple=function(a){BootstrapDialog.confirm("Do you really want to delete these resources ?",function(b){b&&a.deleteResources()})}}]),app.controller("IconDetailsCtrl",["$scope","melmService",function(a,b){"use strict";a.imageId=imageId,a.link={},a.link.LARGE=melmContextRoot+"/rest/icons/file/"+a.imageId+"/LARGE",a.link.MEDIUM=melmContextRoot+"/rest/icons/file/"+a.imageId+"/MEDIUM",a.link.SMALL=melmContextRoot+"/rest/icons/file/"+a.imageId+"/SMALL",a.link.TINY=melmContextRoot+"/rest/icons/file/"+a.imageId+"/TINY",a.changeImage=function(b,c){a.link[b]=melmContextRoot+"/rest/icons/file/"+c+a.imageId+"/"+b},a.go=function(a){b.go(a)}}]),app.controller("IconsCtrl",["$scope","$http","melmService",function(a,b,c){"use strict";a.loadResources=function(){c.loadResources(a,"/rest/icons/linked/json",function(){a.processLinks(a.resources)})},a.links={},a.processLinks=function(b){if(a.links={},b&&0<b.length)for(var c=0;c<b.length;c++){var d=b[c].icon;a.links[d.id]=melmContextRoot+"/rest/icons/file/"+d.id+"/MEDIUM";var e="";b[c]&&b[c].libraries&&0<b[c].libraries.length&&(e=b[c].libraries.sort(function(a,b){return a.name<b.name?-1:a.name>b.name?1:0}).map(function(a){return a.name}).join(",")),angular.extend(b[c].icon,{librariesAsString:e,checked:!1})}},a.changeImage=function(b,c){a.links[b]=melmContextRoot+"/rest/icons/file/"+c+b+"/MEDIUM"},a.hasLibraries=function(a){return a&&a.libraries&&0<a.libraries.length},a.confirmDelete=function(b){c.confirmDelete(a,b)},a.confirmDeleteMultiple=function(){c.confirmDeleteMultiple(a)},a.deleteResource=function(b){c.post({params:{id:b},url:"/rest/icons/delete",successCallback:function(){a.loadResources()},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resource deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.deleteResources=function(){var b=[];if(a.resources&&0<a.resources.length)for(var d=0;d<a.resources.length;d++){var e=a.resources[d],f=e.icon;f.checked&&b.push(f.id)}c.post({params:{ids:b},url:"/rest/icons/deleteMultiple",successCallback:function(){a.loadResources()},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resources deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.go=function(a){c.go(a)},a.allClicked=function(){var b=!a.allChecked();console.log("All clicked to "+b);for(var c=0;c<a.resources.length;c++){var d=a.resources[c].icon;d.checked=b&&!a.hasLibraries(a.resources[c])}},a.allChecked=function(){var b=!0;if(a.resources&&0!==a.resources.length)for(var c=0;c<a.resources.length;c++){var d=a.resources[c].icon;if(!d.checked&&!a.hasLibraries(a.resources[c])){b=!1;break}}else b=!1;return b},a.someSelected=function(){var b=!1;if(a.resources&&0<a.resources.length)for(var c=0;c<a.resources.length;c++){var d=a.resources[c].icon;if(d.checked){b=!0;break}}return b},a.loadingVisible=!1,a.itemsPerPage=8,a.currentPage=1,a.predicate="icon.displayName",a.loadResources()}]),app.controller("ImportLibraryCtrl",["$scope","melmService","$fileUploader",function(a,b,c){"use strict";var d=a.uploader=c.create({scope:a,url:melmContextRoot+"/rest/libraries/import"});d.bind("afteraddingfile",function(b,c){c.formData=[],c.formData.push({libraryName:a.detectLibraryName(c.file.name),version:a.detectLibraryVersion(c.file.name)}),c.alias="libraryFile",$("#libraryFile").attr("disabled","disabled").css("opacity",.4).css("filter","alpha(opacity=40)"),c.remove=function(){d.removeFromQueue(this),$("#libraryFile").removeAttr("disabled").css("opacity",0).css("filter","alpha(opacity=0)")}}),d.bind("success",function(){b.go("/rest/libraries/")}),d.bind("error",function(a,b,c,d){BootstrapDialog.alert({title:"ERROR",message:d,type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}),d.filters.push(function(){return 1!==d.queue.length}),a.go=function(a){b.go(a)},a.detectLibraryName=function(a){var b=a.split("-");return b[0]},a.detectLibraryVersion=function(a){var b=a.split("-"),c=b[1];return c.substr(0,c.length-4)}}]),$(document).on("change",".btn-file :file",function(){"use strict";var a=$(this),b=a.get(0).files?a.get(0).files.length:1,c=a.val().replace(/\\/g,"/").replace(/.*\//,"");a.trigger("fileselect",[b,c])}),$(document).ready(function(){"use strict";$(".btn-file :file").on("fileselect",function(a,b,c){var d=$(this).parents(".input-group").find(":text"),e=b>1?b+" files selected":c;d.length?d.val(e):e&&alert(e)})}),app.controller("LibrariesCtrl",["$scope","$http","melmService",function(a,b,c){"use strict";a.loadResources=function(){c.loadResources(a,"/rest/libraries/json",function(){var b=a.resources;if(b&&b.libraries&&0<b.libraries.length)for(var c=0;c<b.libraries.length;c++){var d=b.libraries[c];angular.extend(d,{checked:!1})}})},a.go=function(a){c.go(a)},a.confirmDelete=function(b){c.confirmDelete(a,b)},a.confirmDeleteMultiple=function(){c.confirmDeleteMultiple(a)},a.deleteResource=function(b){c.post({params:{id:b},url:"/rest/libraries/delete",successCallback:function(){a.loadResources()},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resource deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.deleteResources=function(){var b=[];if(a.resources&&0<a.resources.length)for(var d=0;d<a.resources.length;d++){var e=a.resources[d];e.checked&&b.push(e.id)}c.post({params:{ids:b},url:"/rest/libraries/deleteMultiple",successCallback:function(){a.loadResources()},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resources deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.allClicked=function(){for(var b=!a.allChecked(),c=0;c<a.resources.length;c++){var d=a.resources[c];d.checked=b}},a.allChecked=function(){var b=!0;if(a.resources&&0!==a.resources.length)for(var c=0;c<a.resources.length;c++){var d=a.resources[c];if(!d.checked){b=!1;break}}else b=!1;return b},a.someSelected=function(){var b=!1;if(a.resources&&0<a.resources.length)for(var c=0;c<a.resources.length;c++){var d=a.resources[c];if(d.checked){b=!0;break}}return b},a.loadingVisible=!1,a.itemsPerPage=8,a.currentPage=1,a.predicate="name",a.loadResources()}]),app.controller("LibraryIconsCtrl",["$scope","$document","melmService",function(a,b,c){"use strict";b.bind("keypress",function(b){console.debug(b),124===b.charCode&&alert(angular.toJson(a.resources))}),a.loadResources=function(b){c.loadResources(a,"/rest/libraries/icons/json/"+b,function(){a.processLinks(a.resources),a.totalItems=a.resources.icons.length})},a.confirmDelete=function(b){c.confirmDelete(a,b)},a.confirmDeleteMultiple=function(){c.confirmDeleteMultiple(a)},a.deleteResource=function(b){c.post({params:{id:b},url:"/rest/libraries/icons/delete",successCallback:function(){a.loadResources(c.getRESTParameter("icons/"))},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resource deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.deleteResources=function(){var b=[];if(a.resources&&a.resources.icons&&0<a.resources.icons.length)for(var d=0;d<a.resources.icons.length;d++){var e=a.resources.icons[d];e.icon.checked&&b.push(e.id)}c.post({params:{ids:b},url:"/rest/libraries/icons/deleteMultiple",successCallback:function(){a.loadResources(c.getRESTParameter("icons/"))},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resources deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.links={},a.processLinks=function(b){if(a.links={},b&&b.icons&&0<b.icons.length)for(var c=0;c<b.icons.length;c++){var d=b.icons[c].icon;a.links[d.id]=melmContextRoot+"/rest/icons/file/"+d.id+"/MEDIUM",angular.extend(b.icons[c].icon,{checked:!1})}},a.changeImage=function(b,c){a.links[b]=melmContextRoot+"/rest/icons/file/"+c+b+"/MEDIUM"},a.go=function(a){c.go(a)},a.move=function(b,d){c.post({params:{id:d,which:b},url:"/rest/libraries/icons/move",successCallback:function(){a.loadResources(c.getRESTParameter("icons/"))},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resource move threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.isFirst=function(b){var c=a.resources&&a.resources.icons&&0<a.resources.icons.length&&a.resources.icons[0].id===b;return c},a.isLast=function(b){var c=a.resources&&a.resources.icons&&0<a.resources.icons.length&&a.resources.icons[a.resources.icons.length-1].id===b;return c},a.allClicked=function(){for(var b=!a.allChecked(),c=0;c<a.resources.icons.length;c++){var d=a.resources.icons[c];d.icon.checked=b}},a.allChecked=function(){var b=!0;if(a.resources&&a.resources.icons&&0!==a.resources.icons.length)for(var c=0;c<a.resources.icons.length;c++){var d=a.resources.icons[c];if(!d.icon.checked){b=!1;break}}else b=!1;return b},a.someSelected=function(){var b=!1;if(a.resources&&a.resources.icons&&0<a.resources.icons.length)for(var c=0;c<a.resources.icons.length;c++){var d=a.resources.icons[c];if(d.icon.checked){b=!0;break}}return b},a.loadingVisible=!1,a.itemsPerPage=8,a.currentPage=1,a.predicate="indexOfIconInLibrary",a.loadResources(c.getRESTParameter("icons/"))}]),app.controller("PropertiesCtrl",["$scope","$http","melmService",function(a,b,c){"use strict";a.loadResources=function(b){c.loadResources(a,"/rest/libraries/icons/properties/json/"+b,function(){var b=a.resources;if(b&&b.properties&&0<b.properties.length)for(var c=0;c<b.properties.length;c++){var d=b.properties[c];angular.extend(d,{checked:!1})}})},a.customPropertyTypes=[{id:"DATE",title:"DATE"},{id:"INTEGER",title:"INTEGER"},{id:"STRING",title:"STRING"}],a.resetResource=function(){a.newResource||(a.newResource={}),a.newResource.uniqueName="",a.newResource.type=""},a.createResource=function(b){var d=b?b.uniqueName:"",e=b?b.type:"";c.post({params:{id:c.getRESTParameter("properties/"),uniqueName:"undefined"!=typeof d?d:"",type:"undefined"!=typeof e?e:""},url:"/rest/libraries/icons/properties/add",successCallback:function(){a.resetResource(),a.loadResources(c.getRESTParameter("properties/"))},errorCallback:function(a){BootstrapDialog.alert({title:"ERROR",message:a,type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.updateResource=function(b,d){var e=b?b.uniqueName:"",f=b?b.type:"";c.post({params:{id:d,uniqueName:"undefined"!=typeof e?e:"",type:"undefined"!=typeof f?f:""},url:"/rest/libraries/icons/properties/update",successCallback:function(){a.loadResources(c.getRESTParameter("properties/"))},errorCallback:function(a){BootstrapDialog.alert({title:"ERROR",message:a,type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.confirmDelete=function(b){c.confirmDelete(a,b)},a.confirmDeleteMultiple=function(){c.confirmDeleteMultiple(a)},a.deleteResource=function(b){c.post({params:{id:b},url:"/rest/libraries/icons/properties/delete",successCallback:function(){a.loadResources(c.getRESTParameter("properties/"))},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resource deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.deleteResources=function(){var b=[];if(a.resources&&0<a.resources.length)for(var d=0;d<a.resources.length;d++){var e=a.resources[d];e.checked&&b.push(e.id)}c.post({params:{ids:b},url:"/rest/libraries/icons/properties/deleteMultiple",successCallback:function(){a.loadResources(c.getRESTParameter("properties/"))},errorCallback:function(){BootstrapDialog.alert({title:"ERROR",message:"Resources deletion threw an error.",type:BootstrapDialog.TYPE_DANGER,closable:!0,buttonLabel:"Close"})}})},a.back=function(){c.back()},a.allClicked=function(){for(var b=!a.allChecked(),c=0;c<a.resources.length;c++){var d=a.resources[c];d.checked=b}},a.allChecked=function(){var b=!0;if(a.resources&&0!==a.resources.length)for(var c=0;c<a.resources.length;c++){var d=a.resources[c];if(!d.checked){b=!1;break}}else b=!1;return b},a.someSelected=function(){var b=!1;if(a.resources&&0<a.resources.length)for(var c=0;c<a.resources.length;c++){var d=a.resources[c];if(d.checked){b=!0;break}}return b},a.loadingVisible=!1,a.itemsPerPage=7,a.currentPage=1,a.predicate="uniqueName",a.loadResources(c.getRESTParameter("properties/"))}]),app.controller("StartCtrl",["$scope","melmService",function(a,b){"use strict";a.go=function(a){b.go(a)}}]),app.controller("UpdateIconCtrl",["$scope","$window","melmService",function(a,b,c){"use strict";a.go=function(a){c.go(a)},a.setAnchor=function(b){a.anchor=b},a.getClass=function(b){var c="anchor anchor-"+b;return a.anchor===b?c+" anchor-selected":c},a.anchor=b.anchor,a.iconChoice="leave",a.iconSelectedChoice="leave"}]),app.controller("UpdateLibraryCtrl",["$scope","melmService",function(a,b){"use strict";a.go=function(a){b(a)}}]),app.controller("UpdateLibraryIconCtrl",["$scope","$http","$window","melmService",function(a,b,c,d){"use strict";a.loadResources=function(){d.loadResources(a,"/rest/icons/linked/json",function(){a.processLinks(a.resources)})},a.links={},a.processLinks=function(b){if(a.links={},b&&0<b.length)for(var c=0;c<b.length;c++){var d=b[c].icon;a.links[d.id]=melmContextRoot+"/rest/icons/file/"+d.id+"/MEDIUM"}},a.changeImage=function(b,c){a.links[b]=melmContextRoot+"/rest/icons/file/"+c+b+"/MEDIUM"},a.back=function(){d.back()},a.selectImage=function(b,c){if(c.length>0)for(var d=0;d<c.length;d++)if(c[d].id===a.libraryId&&b!==a.initialIconId)return;a.iconId=b},a.isSelected=function(b){return a.iconId===b},a.getClasses=function(b,c){var d="col-xs-4 col-sm-2 col-md-1 icon-wrapper";if(a.iconId===b)return d+" icon-selected";if(c.length>0)for(var e=0;e<c.length;e++)if(c[e].id===a.libraryId&&b!==a.initialIconId)return d+" icon-wrapper-disabled icon-disabled";return d},a.loadingVisible=!1,a.libraryId=c.libraryId,a.iconId=c.iconId,a.initialIconId=c.iconId,a.itemsPerPage=48,a.currentPage=1,a.loadResources()}]);